mode: rule
ipv6: false
mixed-port: 7890
log-level: error
allow-lan: true
unified-delay: true
tcp-concurrent: true
external-controller: 0.0.0.0:9090
external-ui: ./UI
external-ui-url: "https://github.com/Zephyruso/zashboard/releases/latest/download/dist-cdn-fonts.zip"
routing-mark: 2
profile:
  store-selected: true
  store-fake-ip: true
  tracing: true
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  sniff:
    HTTP:
      ports: [80]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - Mijia Cloud
    - +.lan
    - +.local
    - +.msftconnecttest.com
    - +.msftncsi.com
    - +.3gppnetwork.org
    - +.openwrt.org
    - +.vsean.net
    - cudy.net

hosts:
  ntc.party: 130.255.77.28

dns:
  enable: true
  listen: 0.0.0.0:7880
  ipv6: false
  nameserver:
    - https://dns.google/dns-query
    - https://dns.quad9.net/dns-query
    - https://dns.cloudflare.com/dns-query
    - https://common.dot.dns.yandex.net/dns-query
    - https://unfiltered.adguard-dns.com/dns-query

proxies:

  - name: Домашний интернет
    type: direct

proxy-providers:

  Подписка:
    type: http
    url: "https://..." # ЗДЕСЬ УКАЖИТЕ ССЫЛКУ НА ВАШУ ПОДПИСКУ
    path: ./proxy-providers/sub.yaml
    interval: 86400
    proxy: Домашний интернет
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 300
      timeout: 5000
      lazy: true

proxy-groups:

  - name: "Сервер для YouTube"
    type: fallback
    url: http://gstatic.com/generate_204
    expected-status: 204
    interval: 300
    lazy: true
    icon: https://www.clashverge.dev/assets/icons/youtube.svg
    proxies:
      - "Домашний интернет" # ЕСЛИ ЮТУБ РАБОТАЕТ БЕЗ ВПН
    use:
      - "Подписка"

  - name: "Сервер для российских блокировок"
    type: fallback
    url: http://gstatic.com/generate_204
    expected-status: 204
    interval: 300
    lazy: true
    icon: https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f1f7-1f1fa.svg
    use:
      - "Подписка"

  - name: "Сервер для зарубежных блокировок"
    type: fallback
    url: http://gstatic.com/generate_204
    expected-status: 204
    interval: 300
    lazy: true
    icon: https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f310.svg
    use:
      - "Подписка"

rule-providers:

  youtube:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
    path: ./rule-providers/youtube-list.yaml
    interval: 86400
    
  telegram:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Telegram/Telegram.yaml"
    path: ./rule-providers/telegram-list.yaml
    interval: 86400

  geoblock:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/Internet-Helper/GeoHideDNS/refs/heads/main/lists/Clash/domains.yaml"
    path: ./rule-providers/geoblock-list.yaml
    interval: 86400
    
  roblox:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Game/Roblox/Roblox.yaml"
    path: ./rule-providers/roblox-list.yaml
    interval: 86400
    
  roblox-subnet:
    type: http
    format: text
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Subnets/IPv4/roblox.lst"
    path: ./rule-providers/roblox-subnet-list.lst
    interval: 86400

  tiktok:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/TikTok/TikTok.yaml"
    path: ./rule-providers/tiktok-list.yaml
    interval: 86400

  meta:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Facebook/Facebook.yaml"
    path: ./rule-providers/meta-list.yaml
    interval: 86400

  meta-subnet:
    type: http
    format: text
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/itdoginfo/allow-domains/refs/heads/main/Subnets/IPv4/Meta.lst"
    path: ./rule-providers/meta-subnet-list.lst
    interval: 86400
  
  twitter:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.yaml"
    path: ./rule-providers/twitter-list.yaml
    interval: 86400 

  discord:
    type: http
    format: yaml
    behavior: classical
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Discord/Discord.yaml"
    path: ./rule-providers/discord-list.yaml
    interval: 86400

rules:

  # Правила для доменов
  - DOMAIN-SUFFIX,cloudflare-ech.com,Сервер для российских блокировок

  # Правила для списков
  - RULE-SET,youtube,Сервер для YouTube
  - RULE-SET,telegram,Сервер для российских блокировок
  - RULE-SET,geoblock,Сервер для зарубежных блокировок
  - RULE-SET,roblox,Сервер для зарубежных блокировок
  - RULE-SET,roblox-subnet,Сервер для зарубежных блокировок
  - RULE-SET,tiktok,Сервер для зарубежных блокировок
  - RULE-SET,meta,Сервер для российских блокировок
  - RULE-SET,meta-subnet,Сервер для российских блокировок
  - RULE-SET,twitter,Сервер для российских блокировок
  - RULE-SET,discord,Сервер для российских блокировок
  
  # Правило для всего остального
  - MATCH,Сервер для российских блокировок